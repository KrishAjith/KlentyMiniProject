<html>
<head>
  <title>KlentyMiniProject</title>
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.12/angular-material.min.css">
  <style>
    body {
      overflow: hidden;
    }

    .margin {
      margin: 10px;
    }

    .progress-bar {
      color: #0e960e;
      text-align: center;
      height: 36px;
      padding-top: 7px;
      width: 170px;
      border: 1px solid #0e960e;
      background-color: lightgreen;
      margin-top: 27px;
      border-radius: 4px;
    }

    input[type=submit] {
      cursor: pointer;
      -webkit-appearance: button;
      background: #7d7dc5;
      color: white;
      text-transform: none;
    }

    input[type=file] {
    }

    .title-div {
      padding: 23px;
      font-weight: bold;
      background: #c4c4e4;
    }

    .body-div {
      padding: 50px;
      padding-bottom: 100px;
      overflow: scroll;
    }

    ul {
      list-style: none;
      display: inline-flex;
      margin: 10px;
      padding: 0px;
    }

    li {
      padding: 5px 10px;
      border: 1px solid lightgray;
      outline: none;
    }

      li:hover {
        background: #efecec;
        cursor: pointer;
      }

    .selected-pageno {
      background: #c7c4c4;
      cursor: pointer;
    }

    tr {
      height: 45px;
    }

    .disable-prev-button {
      cursor: not-allowed !important;
    }

    .disable-next-button {
      cursor: not-allowed !important;
    }

    .first-table {
      min-width: 1000px;
    }

      .first-table, .first-table tr, .first-table th, .first-table td {
        border: 0px solid grey;
        border-collapse: collapse;
      }

        .first-table td {
          text-align: center;
        }

        .first-table tr:nth-child(odd) {
          background-color: #f1f1f1;
        }

        .first-table tr:nth-child(even) {
          background-color: #ffffff;
        }
  </style>
</head>
<body ng-app="miniApp" ng-controller="HomeController">
  <div class="title-div" flex="auto"> Klenty Mini Project</div>
  <div flex="auto" layout="row" layout-align="center center"><span ng-if="enableMessage" class="progress-bar">Wait..</span></div>
  <div flex="auto" layout-fill class="body-div">
    <div flex="50" layout="row" layout-align="space-between center">
      <input class="margin" type="file" name="filetoupload" file-model="myFile" class="filetoupload" /><br>
      <input class="margin md-button" type="submit" ng-click="uploadFile()" value="Send" />
    </div>
    <div flex="50" layout="row" layout-align="space-between center">
      <div flex="auto">
        <md-input-container flex="auto">
          <label> Rows : </label>
          <md-select ng-model="rowPerPage" ng-change="ChangeRowPerPage(rowPerPage)">
            <md-option ng-value="5">5</md-option>
            <md-option ng-value="10">10</md-option>
            <md-option ng-value="15">15</md-option>
          </md-select>
        </md-input-container>
      </div>
      <div flex="auto">
        <ul>
          <li ng-if="totalPaginationBtnCount.length > 3" ng-disabled="selectedPageNo-1<1" ng-class="{'disable-prev-button':selectedPageNo-1<1}" ng-click="getRecords(selectedPageNo-1)">&lt;&lt;&nbsp;Prev</li>
          <li ng-repeat="pageNo in tempPaginationBtnCount track by $index" ng-class="{'selected-pageno':pageNo == selectedPageNo }" ng-click="getRecords(pageNo)">{{pageNo}}</li>
          <li ng-if="totalPaginationBtnCount.length > 3" ng-disabled="selectedPageNo==totalPaginationBtnCount.length" ng-class="{'disable-next-button': selectedPageNo+1 > totalPaginationBtnCount.length}" ng-if="totalPaginationBtnCount.length > 3" ng-click="getRecords(selectedPageNo+1)">Next&nbsp;&gt;&gt;</li>
        </ul>
      </div>
    </div>
    <div style="min-height:300px">
      <table class="first-table" flex="50" flex-md="auto" flex-xs="100">
        <tr>
          <th>Firstname</th>
          <th>Lastname</th>
          <th>EmailId</th>
          <th>Gender</th>
          <th>Address</th>
          <th>Phoneno</th>
          <th>Result</th>
        </tr>
        <tr ng-repeat="row in filteredDatas">
    <td>{{row.Data.Firstname}}</td>
    <td>{{row.Data.Lastname}}</td>
    <td>{{row.Data.EmailId}}</td>
    <td>{{row.Data.Gender}}</td>
    <td>{{row.Data.Address}}</td>
    <td>{{row.Data.Phone}}</td>
    <td>{{row.response}}</td>
  </tr>

       <!--For TempData-->
    <!--<tr ng-repeat="row in filteredDatas">
    <td>{{row.Firstname}}</td>
    <td>{{row.Lastname}}</td>
    <td>{{row.EmailId}}</td>
    <td>{{row.Gender}}</td>
    <td>{{row.Address}}</td>
    <td>{{row.Phone}}</td>
    <td>{{row.response}}</td>-->
  </tr>
      </table>
    </div>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.6/angular.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.6/angular-animate.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.6/angular-aria.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.12/angular-material.min.js"></script>
  <script type="text/javascript">
    var miniApp = angular.module("miniApp", ["ngMaterial"]);

    miniApp.directive('fileModel', ['$parse', function ($parse) {
      return {
        restrict: 'A',
        link: function (scope, element, attrs) {
          var model = $parse(attrs.fileModel);
          var modelSetter = model.assign;

          element.bind('change', function () {
            scope.$apply(function () {
              modelSetter(scope, element[0].files[0]);
            });
          });
        }
      };
    }]);

    miniApp.controller("HomeController", function ($scope, $filter, $http, $interval) {
      $scope.selectedPageNo = 1;
      $scope.timer = null;
      $scope.emailDatas = [];
      $scope.totalPaginationBtnCount = [];
      $scope.tempPaginationBtnCount = [];
      var filteredCount = 0;
      $scope.rowPerPage = 5;
      $scope.enableMessage = false;
  

      $scope.uploadFile = function () {
        console.log($scope.myFile.name);
        $http.post('http://localhost:8080/api/fileUpload', { Filename: $scope.myFile.name }).then(function (response) { $scope.enableMessage = true;console.log(response.data) });
        myFunction();
      };

      function myFunction() {
        $scope.timer = $interval(function () {
          $http.get('http://localhost:8080/api/results').then(function (response) {
            console.log(response.data.length);
            if (response.data.length > 0) {
              $scope.emailDatas = response.data;
              $scope.getPaginationButtonCount();
              $scope.getRecords(1);
              console.log($scope.emailDatas);
              $scope.enableMessage = false;
              $interval.cancel($scope.timer);
            }
          });
        }, 5000);
      }

   //Temporary data
      {
      //  $scope.emailDatas = [
      //  {
      //    Firstname: 'Bradley Greer',
      //    Lastname: 'Maud Yates',
      //    EmailId: 'kohbal@ra.bn',
      //    Phone: '(376) 325-3745',
      //    Gender: 'Male',
      //    Address: 'Alejavkud'
      //  },
      //  {
      //    Firstname: 'Lloyd Mathis',
      //    Lastname: 'Augusta Little',
      //    EmailId: 'gimdeziz@te.ps',
      //    Phone: '(814) 413-7576',
      //    Gender: 'Female',
      //    Address: 'Tahila'
      //  },
      //  {
      //    Firstname: 'Maggie Clarke',
      //    Lastname: 'Ellen Buchanan',
      //    EmailId: 'to@okmul.pa',
      //    Phone: '(206) 681-5556',
      //    Gender: 'Female',
      //    Address: 'Egakefu'
      //  },
      //  {
      //    Firstname: 'Cecelia Myers',
      //    Lastname: 'Evan Spencer',
      //    EmailId: 'na@rogvon.ec',
      //    Phone: '(557) 245-7706',
      //    Gender: 'Female',
      //    Address: 'Jakese'
      //  },
      //  {
      //    Firstname: 'Craig Elliott',
      //    Lastname: 'Gordon Alexander',
      //    EmailId: 'igale@woz.an',
      //    Phone: '(224) 366-9190',
      //    Gender: 'Male',
      //    Address: 'Soknotbi'
      //  },
      //  {
      //    Firstname: 'Grace Reeves',
      //    Lastname: 'Joel Klein',
      //    EmailId: 'jatvow@ba.ke',
      //    Phone: '(712) 820-9828',
      //    Gender: 'Male',
      //    Address: 'Ujavijem'
      //  },
      //  {
      //    Firstname: 'Sallie Warren',
      //    Lastname: 'Virginia Harper',
      //    EmailId: 'liute@bojej.mg',
      //    Phone: '(675) 599-6327',
      //    Gender: 'Male',
      //    Address: 'Wuhocac'
      //  },
      //  {
      //    Firstname: 'Scott Rhodes',
      //    Lastname: 'Mina Ellis',
      //    EmailId: 'sardanpa@fuc.jo',
      //    Phone: '(505) 442-3952',
      //    Gender: 'Male',
      //    Address: 'Jothide'
      //  },
      //  {
      //    Firstname: 'Gabriel McKenzie',
      //    Lastname: 'Brett Abbott',
      //    EmailId: 'ushe@tumuhadeg.do',
      //    Phone: '(982) 826-2577',
      //    Gender: 'Male',
      //    Address: 'Jefejdu'
      //  },
      //  {
      //    Firstname: 'Anne Cook',
      //    Lastname: 'Caroline Hudson',
      //    EmailId: 'malel@gahizobiw.tn',
      //    Phone: '(875) 858-3586',
      //    Gender: 'Female',
      //    Address: 'Nejjilheg'
      //  },
      //  {
      //    Firstname: 'Lucy Sandoval',
      //    Lastname: 'Cynthia Turner',
      //    EmailId: 'bipu@ninko.sk',
      //    Phone: '(914) 612-5026',
      //    Gender: 'Male',
      //    Address: 'Berjuevo'
      //  },
      //  {
      //    Firstname: 'Callie Cannon',
      //    Lastname: 'Alan Blair',
      //    EmailId: 'cu@cozupwa.ac',
      //    Phone: '(340) 632-8743',
      //    Gender: 'Male',
      //    Address: 'Bacmewac'
      //  },
      //  {
      //    Firstname: 'Elsie Lamb',
      //    Lastname: 'Ann Brady',
      //    EmailId: 'gak@bo.la',
      //    Phone: '(232) 954-3138',
      //    Gender: 'Female',
      //    Address: 'Nihido'
      //  },
      //  {
      //    Firstname: 'Francisco Pierce',
      //    Lastname: 'Luis Franklin',
      //    EmailId: 'du@kivosle.tm',
      //    Phone: '(521) 854-9148',
      //    Gender: 'Male',
      //    Address: 'Rudpuzsud'
      //  },
      //  {
      //    Firstname: 'Augusta Walsh',
      //    Lastname: 'Sallie Moran',
      //    EmailId: 'abudeb@pamic.vg',
      //    Phone: '(771) 455-3013',
      //    Gender: 'Female',
      //    Address: 'Efjunud'
      //  },
      //  {
      //    Firstname: 'Linnie Alvarado',
      //    Lastname: 'Connor Cruz',
      //    EmailId: 'cuuze@cit.iq',
      //    Phone: '(561) 869-9442',
      //    Gender: 'Female',
      //    Address: 'Diuwozoh'
      //  },
      //  {
      //    Firstname: 'Katharine Howard',
      //    Lastname: 'Josie Sharp',
      //    EmailId: 'ga@dejoz.ao',
      //    Phone: '(643) 775-2328',
      //    Gender: 'Female',
      //    Address: 'Ruwkuwfin'
      //  },
      //  {
      //    Firstname: 'Russell Bass',
      //    Lastname: 'Harvey Cole',
      //    EmailId: 'fu@dohep.no',
      //    Phone: '(732) 439-3876',
      //    Gender: 'Male',
      //    Address: 'Awaopoba'
      //  },
      //  {
      //    Firstname: 'Luke Lucas',
      //    Lastname: 'Terry Butler',
      //    EmailId: 'dikugdi@ahna.sk',
      //    Phone: '(980) 861-6525',
      //    Gender: 'Female',
      //    Address: 'Vultumnaw'
      //  },
      //  {
      //    Firstname: 'Nell Lamb',
      //    Lastname: 'Brian Tran',
      //    EmailId: 'ti@ja.cf',
      //    Phone: '(215) 593-7586',
      //    Gender: 'Female',
      //    Address: 'Ajejoagu'
      //  },
      //  {
      //    Firstname: 'Caroline Lyons',
      //    Lastname: 'Andrew Cunningham',
      //    EmailId: 'la@gaha.kg',
      //    Phone: '(760) 993-7559',
      //    Gender: 'Female',
      //    Address: 'Zitroti'
      //  },
      //  {
      //    Firstname: 'Ricardo Carter',
      //    Lastname: 'Ryan Patton',
      //    EmailId: 'lok@mi.mz',
      //    Phone: '(514) 671-9294',
      //    Gender: 'Female',
      //    Address: 'Nofetnup'
      //  },
      //  {
      //    Firstname: 'Antonio Stone',
      //    Lastname: 'Celia McBride',
      //    EmailId: 'nebkolar@raaz.eu',
      //    Phone: '(848) 700-3287',
      //    Gender: 'Female',
      //    Address: 'Lutaat'
      //  },
      //  {
      //    Firstname: 'Edgar Sharp',
      //    Lastname: 'Jeremiah Klein',
      //    EmailId: 'hetoh@suv.uz',
      //    Phone: '(519) 757-4656',
      //    Gender: 'Female',
      //    Address: 'Geuppig'
      //  },
      //  {
      //    Firstname: 'Rosa Mason',
      //    Lastname: 'Oscar Allen',
      //    EmailId: 'ek@rilzeuso.fm',
      //    Phone: '(976) 678-1816',
      //    Gender: 'Female',
      //    Address: 'Wusevfec'
      //  },
      //  {
      //    Firstname: 'Cecilia Rodriquez',
      //    Lastname: 'Mitchell Perry',
      //    EmailId: 'elo@piw.pl',
      //    Phone: '(708) 217-4241',
      //    Gender: 'Female',
      //    Address: 'Tukopju'
      //  },
      //  {
      //    Firstname: 'Essie Nguyen',
      //    Lastname: 'Bettie Larson',
      //    EmailId: 'bewbib@huwmodfa.rw',
      //    Phone: '(616) 481-4781',
      //    Gender: 'Male',
      //    Address: 'Sihjahlaj'
      //  },
      //  {
      //    Firstname: 'Paul Spencer',
      //    Lastname: 'Brent Stewart',
      //    EmailId: 'subva@mafzeli.va',
      //    Phone: '(423) 782-9994',
      //    Gender: 'Female',
      //    Address: 'Peratkut'
      //  },
      //  {
      //    Firstname: 'Chris Carlson',
      //    Lastname: 'Tommy Richards',
      //    EmailId: 'eve@van.tn',
      //    Phone: '(833) 340-5910',
      //    Gender: 'Female',
      //    Address: 'Sekagok'
      //  },
      //  {
      //    Firstname: 'Iva McKenzie',
      //    Lastname: 'Seth Bennett',
      //    EmailId: 'be@utse.az',
      //    Phone: '(954) 787-6912',
      //    Gender: 'Female',
      //    Address: 'Ditkaka'
      //  }
      //];
      }
      

      $scope.getPaginationButtonCount = function () {
        if (parseInt($scope.emailDatas.length / $scope.rowPerPage) < ($scope.emailDatas.length / $scope.rowPerPage)) {
          filteredCount = parseInt($scope.emailDatas.length / $scope.rowPerPage) + 1;
        }
        else {
          filteredCount = $scope.emailDatas.length / $scope.rowPerPage;
        }
        var index = 0;
        $scope.totalPaginationBtnCount = [];
        $scope.tempPaginationBtnCount = [];
        for (index = 0; index < filteredCount; index++) {
          $scope.totalPaginationBtnCount.push(index + 1);
        }
        var i = 0;
        for (i = 0; i < $scope.totalPaginationBtnCount.length && i < 3; i++) {
          $scope.tempPaginationBtnCount.push(i + 1);
        }
      };

      $scope.getRecords = function (pageNo) {
      if (pageNo > 0 && pageNo <= $scope.totalPaginationBtnCount.length) {
          $scope.getTempPagination(pageNo);
          $scope.selectedPageNo = pageNo;
          $scope.filteredDatas = $scope.emailDatas.slice(($scope.rowPerPage * pageNo) - $scope.rowPerPage, ($scope.rowPerPage * pageNo));
        }
      }

      $scope.getIndexByPageNo = function (pageNo) {
        var i = 0;
        for (i = 0; i < $scope.tempPaginationBtnCount.length; i++) {
          if ($scope.tempPaginationBtnCount[i] == pageNo) {
            return i;
          }
        }
      }

      $scope.getTempPagination = function (pageNo) {
        if ($scope.getIndexByPageNo(pageNo) == 0 && pageNo != 1) {
          var i = $scope.tempPaginationBtnCount.length - 1;
          do {
            $scope.tempPaginationBtnCount[i] = $scope.tempPaginationBtnCount[i - 1];
            i--;
          } while (i != 0);
          $scope.tempPaginationBtnCount[i] = $scope.tempPaginationBtnCount[i + 1] - 1;
        }
        else if (pageNo == $scope.totalPaginationBtnCount.length) {

        }
        else if ($scope.getIndexByPageNo(pageNo) == ($scope.tempPaginationBtnCount.length - 1)) {
          var i = 0;
          do {
            $scope.tempPaginationBtnCount[i] = $scope.tempPaginationBtnCount[i + 1];
            i++;
          } while (($scope.tempPaginationBtnCount.length - 2) == i);
          $scope.tempPaginationBtnCount[i] = $scope.tempPaginationBtnCount[i - 1] + 1;
        }
      };

      $scope.ChangeRowPerPage = function (num) {
        $scope.rowPerPage = num;
        $scope.getPaginationButtonCount();
        $scope.getRecords($scope.selectedPageNo);

      };

      $scope.getPaginationButtonCount();
      $scope.getRecords(1);
    });


  </script>
</body>
</html>